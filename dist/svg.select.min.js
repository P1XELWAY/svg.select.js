/*! svg.select.js v3.0.1 MIT*/;!function(){"use strict";function i(t){t.remember("_resizeHandler",this),this.el=t,this.parameters={},this.lastUpdateCall=null,this.p=t.doc().node.createSVGPoint()}i.prototype.transformPoint=function(t,i,e){return this.p.x=t-(this.offset.x-window.pageXOffset),this.p.y=i-(this.offset.y-window.pageYOffset),this.p.matrixTransform(e||this.m)},i.prototype._extractPosition=function(t){return{x:null!=t.clientX?t.clientX:t.touches[0].clientX,y:null!=t.clientY?t.clientY:t.touches[0].clientY}},i.prototype.init=function(t){var i=this;if(this.stop(),"stop"!==t){for(var e in this.options={},this.el.resize.defaults)this.options[e]=this.el.resize.defaults[e],void 0!==t[e]&&(this.options[e]=t[e]);this.el.on("lt.resize",function(t){i.resize(t||window.event)}),this.el.on("rt.resize",function(t){i.resize(t||window.event)}),this.el.on("rb.resize",function(t){i.resize(t||window.event)}),this.el.on("lb.resize",function(t){i.resize(t||window.event)}),this.el.on("t.resize",function(t){i.resize(t||window.event)}),this.el.on("r.resize",function(t){i.resize(t||window.event)}),this.el.on("b.resize",function(t){i.resize(t||window.event)}),this.el.on("l.resize",function(t){i.resize(t||window.event)}),this.el.on("rot.resize",function(t){i.resize(t||window.event)}),this.el.on("point.resize",function(t){i.resize(t||window.event)}),this.update()}},i.prototype.stop=function(){return this.el.off("lt.resize"),this.el.off("rt.resize"),this.el.off("rb.resize"),this.el.off("lb.resize"),this.el.off("t.resize"),this.el.off("r.resize"),this.el.off("b.resize"),this.el.off("l.resize"),this.el.off("rot.resize"),this.el.off("point.resize"),this},i.prototype.resize=function(t){var i=this;this.m=this.el.node.getScreenCTM().inverse(),this.offset={x:window.pageXOffset,y:window.pageYOffset};var e=this._extractPosition(t.detail.event);if(this.parameters={type:this.el.type,p:this.transformPoint(e.x,e.y),x:t.detail.x,y:t.detail.y,box:this.el.bbox(),rotation:this.el.transform().rotation},"text"===this.el.type&&(this.parameters.fontSize=this.el.attr()["font-size"]),void 0!==t.detail.i){var s=this.el.array().valueOf();this.parameters.i=t.detail.i,this.parameters.pointCoords=[s[t.detail.i][0],s[t.detail.i][1]]}switch(t.type){case"lt":this.calc=function(t,i){var e=this.snapToGrid(t,i);if(0<this.parameters.box.width-e[0]&&0<this.parameters.box.height-e[1]){if("text"===this.parameters.type)return this.el.move(this.parameters.box.x+e[0],this.parameters.box.y),void this.el.attr("font-size",this.parameters.fontSize-e[0]);e=this.checkAspectRatio(e);var s=this.options.minWidth&&this.options.minWidth>this.parameters.box.width-e[0],r=this.options.minHeight&&this.options.minHeight>this.parameters.box.height-e[1];s&&!r?(this.el.move(this.el.x(),this.parameters.box.y+e[1]).size(this.options.minWidth,this.parameters.box.height-e[1]),this.parameters.box.previewY=this.parameters.box.y+e[1]):!s&&r?(this.el.move(this.parameters.box.x+e[0],this.el.y()).size(this.parameters.box.width-e[0],this.options.minHeight),this.parameters.box.previewX=this.parameters.box.x+e[0]):s&&r?this.el.move(this.el.x(),this.el.y()).size(this.options.minWidth,this.options.minHeight):this.el.move(this.parameters.box.x+e[0],this.parameters.box.y+e[1]).size(this.parameters.box.width-e[0],this.parameters.box.height-e[1])}};break;case"rt":this.calc=function(t,i){var e=this.snapToGrid(t,i,2);if(0<this.parameters.box.width+e[0]&&0<this.parameters.box.height-e[1]){if("text"===this.parameters.type)return this.el.move(this.parameters.box.x-e[0],this.parameters.box.y),void this.el.attr("font-size",this.parameters.fontSize+e[0]);e=this.checkAspectRatio(e,!0);var s=this.options.minWidth&&this.options.minWidth>this.parameters.box.width+e[0],r=this.options.minHeight&&this.options.minHeight>this.parameters.box.height-e[1];s&&!r?(this.el.move(this.el.x(),this.parameters.box.y+e[1]).size(this.options.minWidth,this.parameters.box.height-e[1]),this.parameters.box.previewY=this.parameters.box.y+e[1]):!s&&r?(this.el.move(this.parameters.box.x,this.el.y()).size(this.parameters.box.width+e[0],this.options.minHeight),this.parameters.box.previewX=this.parameters.box.x):s&&r?this.el.move(this.el.x(),this.el.y()).size(this.options.minWidth,this.options.minHeight):this.el.move(this.parameters.box.x,this.parameters.box.y+e[1]).size(this.parameters.box.width+e[0],this.parameters.box.height-e[1])}};break;case"rb":this.calc=function(t,i){var e=this.snapToGrid(t,i,0);if(0<this.parameters.box.width+e[0]&&0<this.parameters.box.height+e[1]){if("text"===this.parameters.type)return this.el.move(this.parameters.box.x-e[0],this.parameters.box.y),void this.el.attr("font-size",this.parameters.fontSize+e[0]);e=this.checkAspectRatio(e);var s=this.options.minWidth&&this.options.minWidth>this.parameters.box.width+e[0],r=this.options.minHeight&&this.options.minHeight>this.parameters.box.height+e[1];s&&!r?this.el.move(this.parameters.box.x,this.parameters.box.y).size(this.options.minWidth,this.parameters.box.height+e[1]):!s&&r?this.el.move(this.parameters.box.x,this.parameters.box.y).size(this.parameters.box.width+e[0],this.options.minHeight):s&&r?this.el.move(this.parameters.box.x,this.parameters.box.y).size(this.options.minWidth,this.options.minHeight):this.el.move(this.parameters.box.x,this.parameters.box.y).size(this.parameters.box.width+e[0],this.parameters.box.height+e[1])}};break;case"lb":this.calc=function(t,i){var e=this.snapToGrid(t,i,1);if(0<this.parameters.box.width-e[0]&&0<this.parameters.box.height+e[1]){if("text"===this.parameters.type)return this.el.move(this.parameters.box.x+e[0],this.parameters.box.y),void this.el.attr("font-size",this.parameters.fontSize-e[0]);e=this.checkAspectRatio(e,!0);var s=this.options.minWidth&&this.options.minWidth>this.parameters.box.width-e[0],r=this.options.minHeight&&this.options.minHeight>this.parameters.box.height+e[1];s&&!r?this.el.move(this.el.x(),this.parameters.box.y).size(this.options.minWidth,this.parameters.box.height+e[1]):!s&&r?(this.el.move(this.parameters.box.x+e[0],this.parameters.box.y).size(this.parameters.box.width-e[0],this.options.minHeight),this.parameters.box.previewX=this.parameters.box.x+e[0]):s&&r?this.el.move(this.el.x(),this.parameters.box.y).size(this.options.minWidth,this.options.minHeight):this.el.move(this.parameters.box.x+e[0],this.parameters.box.y).size(this.parameters.box.width-e[0],this.parameters.box.height+e[1])}};break;case"t":this.calc=function(t,i){var e=this.snapToGrid(t,i,2);if(0<this.parameters.box.height-e[1]){if("text"===this.parameters.type)return;this.options.minHeight&&this.options.minHeight>this.parameters.box.height-e[1]?this.el.move(this.parameters.box.x,this.el.y()).height(this.options.minHeight):this.el.move(this.parameters.box.x,this.parameters.box.y+e[1]).height(this.parameters.box.height-e[1])}};break;case"r":this.calc=function(t,i){var e=this.snapToGrid(t,i,0);if(0<this.parameters.box.width+e[0]){if("text"===this.parameters.type)return;this.options.minWidth&&this.options.minWidth>this.parameters.box.width+e[0]?this.el.move(this.parameters.box.x,this.parameters.box.y).width(this.options.minWidth):this.el.move(this.parameters.box.x,this.parameters.box.y).width(this.parameters.box.width+e[0])}};break;case"b":this.calc=function(t,i){var e=this.snapToGrid(t,i,0);if(0<this.parameters.box.height+e[1]){if("text"===this.parameters.type)return;this.options.minHeight&&this.options.minHeight>this.parameters.box.height+e[1]?this.el.move(this.parameters.box.x,this.parameters.box.y).height(this.options.minHeight):this.el.move(this.parameters.box.x,this.parameters.box.y).height(this.parameters.box.height+e[1])}};break;case"l":this.calc=function(t,i){var e=this.snapToGrid(t,i,1);if(0<this.parameters.box.width-e[0]){if("text"===this.parameters.type)return;this.options.minWidth&&this.options.minWidth>this.parameters.box.width-e[0]?this.el.move(this.el.x(),this.parameters.box.y).width(this.options.minHeight):this.el.move(this.parameters.box.x+e[0],this.parameters.box.y).width(this.parameters.box.width-e[0])}};break;case"rot":this.calc=function(t,i){var e=t+this.parameters.p.x,s=i+this.parameters.p.y,r=Math.atan2(this.parameters.p.y-this.parameters.box.y-this.parameters.box.height/2,this.parameters.p.x-this.parameters.box.x-this.parameters.box.width/2),o=Math.atan2(s-this.parameters.box.y-this.parameters.box.height/2,e-this.parameters.box.x-this.parameters.box.width/2),h=this.parameters.rotation+180*(o-r)/Math.PI+this.options.snapToAngle/2;this.el.center(this.parameters.box.cx,this.parameters.box.cy).rotate(h-h%this.options.snapToAngle,this.parameters.box.cx,this.parameters.box.cy)};break;case"point":this.calc=function(t,i){var e=this.snapToGrid(t,i,this.parameters.pointCoords[0],this.parameters.pointCoords[1]),s=this.el.array().valueOf();s[this.parameters.i][0]=this.parameters.pointCoords[0]+e[0],s[this.parameters.i][1]=this.parameters.pointCoords[1]+e[1],this.el.plot(s)}}this.el.fire("resizestart",{dx:this.parameters.x,dy:this.parameters.y,event:t}),SVG.on(window,"touchmove.resize",function(t){i.update(t||window.event)}),SVG.on(window,"touchend.resize",function(){i.done()}),SVG.on(window,"mousemove.resize",function(t){i.update(t||window.event)}),SVG.on(window,"mouseup.resize",function(){i.done()})},i.prototype.update=function(t){if(t){if(!this.el.fire("before_resizing",{event:t})._event.defaultPrevented){var i=this._extractPosition(t),e=this.transformPoint(i.x,i.y),s=e.x-this.parameters.p.x,r=e.y-this.parameters.p.y;this.lastUpdateCall=[s,r],this.el.fire("before_resizing",{mx:t.movementX,my:t.movementY,dx:s,dy:r,event:t})._event.defaultPrevented||(this.calc(s,r),this.el.fire("resizing",{dx:s,dy:r,event:t}))}}else this.lastUpdateCall&&this.calc(this.lastUpdateCall[0],this.lastUpdateCall[1])},i.prototype.done=function(){this.lastUpdateCall=null,SVG.off(window,"mousemove.resize"),SVG.off(window,"mouseup.resize"),SVG.off(window,"touchmove.resize"),SVG.off(window,"touchend.resize"),this.el.fire("resizedone")},i.prototype.snapToGrid=function(t,i,e,s){var r;return r=void 0!==s?[(e+t)%this.options.snapToGrid,(s+i)%this.options.snapToGrid]:(e=null==e?3:e,[(this.parameters.box.x+t+(1&e?0:this.parameters.box.width))%this.options.snapToGrid,(this.parameters.box.y+i+(2&e?0:this.parameters.box.height))%this.options.snapToGrid]),t<0&&(r[0]-=this.options.snapToGrid),i<0&&(r[1]-=this.options.snapToGrid),t-=Math.abs(r[0])<this.options.snapToGrid/2?r[0]:r[0]-(t<0?-this.options.snapToGrid:this.options.snapToGrid),i-=Math.abs(r[1])<this.options.snapToGrid/2?r[1]:r[1]-(i<0?-this.options.snapToGrid:this.options.snapToGrid),this.constraintToBox(t,i,e,s)},i.prototype.constraintToBox=function(t,i,e,s){var r,o,h=this.options.constraint||{};return o=void 0!==s?(r=e,s):(r=this.parameters.box.x+(1&e?0:this.parameters.box.width),this.parameters.box.y+(2&e?0:this.parameters.box.height)),void 0!==h.minX&&r+t<h.minX&&(t=h.minX-r),void 0!==h.maxX&&r+t>h.maxX&&(t=h.maxX-r),void 0!==h.minY&&o+i<h.minY&&(i=h.minY-o),void 0!==h.maxY&&o+i>h.maxY&&(i=h.maxY-o),[t,i]},i.prototype.checkAspectRatio=function(t,i){if(!this.options.saveAspectRatio)return t;var e=t.slice(),s=this.parameters.box.width/this.parameters.box.height,r=this.parameters.box.width+t[0],o=this.parameters.box.height-t[1],h=r/o;return h<s?(e[1]=r/s-this.parameters.box.height,i&&(e[1]=-e[1])):s<h&&(e[0]=this.parameters.box.width-o*s,i&&(e[0]=-e[0])),e},SVG.extend(SVG.Element,{resize:function(t){return(this.remember("_resizeHandler")||new i(this)).init(t||{}),this}}),SVG.Element.prototype.resize.defaults={snapToAngle:.1,snapToGrid:1,constraint:{},saveAspectRatio:!1,minWidth:null,minHeight:null}}();